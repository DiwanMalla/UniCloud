# Supabase Database Setup

## Database Schema

### Files Table
```sql
CREATE TABLE files (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  user_id TEXT NOT NULL,
  original_name TEXT NOT NULL,
  encrypted_name TEXT NOT NULL,
  file_size BIGINT NOT NULL,
  file_type TEXT NOT NULL,
  encryption_key TEXT NOT NULL,
  storage_path TEXT NOT NULL,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Add index for better query performance
CREATE INDEX idx_files_user_id ON files(user_id);
CREATE INDEX idx_files_created_at ON files(created_at);
```

## Storage Setup

### Storage Bucket
1. Create a bucket named `user-files`
2. Set up Row Level Security (RLS) policies:

```sql
-- Enable RLS on the files table
ALTER TABLE files ENABLE ROW LEVEL SECURITY;

-- Policy: Users can only see their own files
CREATE POLICY "Users can view own files" ON files
  FOR SELECT USING (auth.uid()::text = user_id);

-- Policy: Users can only insert their own files
CREATE POLICY "Users can insert own files" ON files
  FOR INSERT WITH CHECK (auth.uid()::text = user_id);

-- Policy: Users can only update their own files
CREATE POLICY "Users can update own files" ON files
  FOR UPDATE USING (auth.uid()::text = user_id);

-- Policy: Users can only delete their own files
CREATE POLICY "Users can delete own files" ON files
  FOR DELETE USING (auth.uid()::text = user_id);
```

### Storage Bucket Policies
```sql
-- Policy: Users can upload files to their own folder
CREATE POLICY "Users can upload to own folder" ON storage.objects
  FOR INSERT WITH CHECK (bucket_id = 'user-files' AND auth.uid()::text = (storage.foldername(name))[1]);

-- Policy: Users can view files in their own folder
CREATE POLICY "Users can view own files" ON storage.objects
  FOR SELECT USING (bucket_id = 'user-files' AND auth.uid()::text = (storage.foldername(name))[1]);

-- Policy: Users can delete files from their own folder
CREATE POLICY "Users can delete own files" ON storage.objects
  FOR DELETE USING (bucket_id = 'user-files' AND auth.uid()::text = (storage.foldername(name))[1]);
```

## Security Features

1. **Client-side Encryption**: Files are encrypted before upload using AES encryption
2. **Secure File Names**: Original file names are replaced with random UUIDs
3. **User Isolation**: RLS ensures users can only access their own files
4. **Secure Authentication**: GitHub OAuth integration
5. **HTTPS**: All communications are encrypted in transit

## Environment Variables Needed

```env
NEXT_PUBLIC_SUPABASE_URL=your-supabase-project-url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-supabase-anon-key
GITHUB_ID=your-github-oauth-app-id
GITHUB_SECRET=your-github-oauth-app-secret
NEXTAUTH_URL=http://localhost:3000
NEXTAUTH_SECRET=your-secret-key-minimum-32-characters
```
